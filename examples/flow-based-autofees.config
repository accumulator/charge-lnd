# Flow-based autofees configuration with peer-level fee consistency
# Similar to Lightning Terminal's autofees but using charge-lnd
#
# This configuration ensures that all channels to the same peer have the same fees
# by using proportional strategy with sum_peer_chans for consistent peer-level fees

[default]
# Default policy for channels that don't match specific criteria
# Use proportional strategy to ensure consistent fees per peer
strategy = proportional
base_fee_msat = 1000
min_fee_ppm = 50
max_fee_ppm = 200
# This ensures all channels to the same peer use combined balance
sum_peer_chans = true

[flow-based-main]
# Main flow-based policy for most channels
# Excludes very small channels and very new channels
chan.min_capacity = 1000000
# At least 1 day old (144 blocks)
chan.min_age = 144

strategy = flow_based
base_fee_msat = 1000
# This ensures all channels to the same peer use combined balance
sum_peer_chans = true

# Flow-based strategy parameters
# Look back 60 days for target calculation
reference_period_days = 60
# Analyze last 7 days for performance
analysis_period_days = 7
# Use top 5 earning channels for target
top_earners_count = 5
# Adjust fees by 5% each time
fee_adjustment_pct = 5.0
# Apply scarcity pricing when < 12.5% local balance
liquidity_threshold = 0.125
# 20% fee increase for low liquidity
scarcity_multiplier = 1.2
# Minimum fee rate
min_fee_ppm = 1
# Maximum fee rate
max_fee_ppm = 5000

[high-performers]
# Channels that are already performing well - be more conservative
# Performing 20% above target
chan.min_throughput_ratio = 1.2
# Top 10 earning channels
chan.max_earning_rank = 10

strategy = flow_based
base_fee_msat = 1000
# This ensures all channels to the same peer use combined balance
sum_peer_chans = true
# Smaller adjustments for good performers
fee_adjustment_pct = 3.0
# Higher minimum for top performers
min_fee_ppm = 10
max_fee_ppm = 3000

[underperformers]
# Channels performing below target - more aggressive fee reductions
# Performing less than 50% of target
chan.max_throughput_ratio = 0.5
# Not in top 20 earners
chan.min_earning_rank = 20

strategy = flow_based
# Lower base fee to attract traffic
base_fee_msat = 500
# This ensures all channels to the same peer use combined balance
sum_peer_chans = true
# More aggressive adjustments
fee_adjustment_pct = 10.0
min_fee_ppm = 1
max_fee_ppm = 2000

[new-channels]
# New channels - start with moderate fees and let flow-based adjust
# Less than 1 week old (1008 blocks)
chan.max_age = 1008

strategy = static
base_fee_msat = 1000
# Start with lower fees for new channels
fee_ppm = 50

[small-channels]
# Small channels - use static fees as flow data may be unreliable
chan.max_capacity = 1000000

strategy = static
base_fee_msat = 1000
# Higher fees for small channels
fee_ppm = 200

[private-channels]
# Private channels - typically used for specific purposes
chan.private = true

strategy = static
base_fee_msat = 2000
# Higher fees for private channels
fee_ppm = 500

[high-liquidity-channels]
# Channels with plenty of outbound liquidity - can afford higher fees
# At least 80% local balance
chan.min_ratio = 0.8

strategy = flow_based
base_fee_msat = 1500
# This ensures all channels to the same peer use combined balance
sum_peer_chans = true
# Conservative adjustments
fee_adjustment_pct = 3.0
# Only apply scarcity pricing below 20%
liquidity_threshold = 0.2
# Higher minimum for liquid channels
min_fee_ppm = 20
max_fee_ppm = 4000

[low-liquidity-channels]
# Channels with low outbound liquidity - encourage rebalancing
# Less than 20% local balance
chan.max_ratio = 0.2

strategy = flow_based
# Lower base fee
base_fee_msat = 500
# This ensures all channels to the same peer use combined balance
sum_peer_chans = true
# More aggressive to encourage flow
fee_adjustment_pct = 8.0
# Very low threshold for scarcity pricing
liquidity_threshold = 0.05
# Higher scarcity multiplier
scarcity_multiplier = 1.5
min_fee_ppm = 1
max_fee_ppm = 6000
